<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dish Recipes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    form input, form select {
      margin: 6px 4px;
      padding: 6px;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
    }
    table {
      margin-top: 20px;
      width: 100%;
    }
    /* Style for the "Add Dish" submit button */
    .submit-btn {
      background-color: #4CAF50; /* Green */
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
    }
    /* Style for Update and Delete buttons */
    .update-btn {
      background-color: #4CAF50; /* Green */
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      margin: 4px;
    }
    .delete-btn {
      background-color: #f44336; /* Red */
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      margin: 4px;
    }
    /* Style for the new dish button */
    #new-dish-btn {
      background-color: #008CBA; /* Blue */
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      margin-top: 20px;
    }
    h1, h2 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <h1>Dish Recipes</h1>
  
  <!-- Form to add a new dish -->
  <h2>Add New Dish</h2>
  <form id="add-dish-form" autocomplete="off">
    <input type="text" name="name" placeholder="Name" required autocomplete="off" />
    <input type="text" name="ingredients" placeholder="Ingredients (comma separated)" required autocomplete="off" />
    <input type="text" name="preparationSteps" placeholder="Preparation Steps (comma separated)" required autocomplete="off" />
    <input type="number" name="cookingTime" placeholder="Cooking Time (min)" required autocomplete="off" min="1" />
    <input type="text" name="origin" placeholder="Origin" required autocomplete="off" />
    <!-- Spice Level input as a number with allowed range -->
    <input type="number" name="spiceLevel" placeholder="Spice Level (0 to 5)" required autocomplete="off" min="0" max="5" step="1" />
    <button type="submit" class="submit-btn">Add Dish</button>
  </form>
  
  <!-- Table to display dishes -->
  <h2>All Dishes</h2>
  <table id="dishes-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Ingredients</th>
        <th>Preparation Steps</th>
        <th>Cooking Time</th>
        <th>Origin</th>
        <th>Spice Level</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <script>
    const API_URL = '/api/dishes';

    async function loadDishes() {
      try {
        const response = await fetch(API_URL);
        const dishes = await response.json();
        const tbody = document.querySelector('#dishes-table tbody');
        tbody.innerHTML = '';
        dishes.forEach(dish => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${dish.name}</td>
            <td>${dish.ingredients.join(', ')}</td>
            <td>${dish.preparationSteps.join(', ')}</td>
            <td>${dish.cookingTime}</td>
            <td>${dish.origin}</td>
            <td>${dish.spiceLevel}</td>
            <td>
              <button class="update-btn" onclick="showUpdateForm('${dish._id}', '${dish.name}', '${dish.ingredients}', '${dish.preparationSteps}', ${dish.cookingTime}, '${dish.origin}', ${dish.spiceLevel})">Update</button>
              <button class="delete-btn" onclick="deleteDish('${dish._id}')">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error('Error loading dishes:', error);
      }
    }

    document.getElementById('add-dish-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {
        name: formData.get('name'),
        ingredients: formData.get('ingredients').split(',').map(i => i.trim()),
        preparationSteps: formData.get('preparationSteps').split(',').map(step => step.trim()),
        cookingTime: Number(formData.get('cookingTime')),
        origin: formData.get('origin'),
        spiceLevel: Number(formData.get('spiceLevel'))
      };
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (response.status === 201) {
        await loadDishes();
        e.target.reset();
      } else {
        const errorData = await response.json();
        alert(errorData.error || 'Error adding dish');
      }
    });

    async function showUpdateForm(id, name, ingredients, preparationSteps, cookingTime, origin, spiceLevel) {
      const newName = prompt('Enter new name:', name);
      if (!newName) return;
      const newIngredients = prompt('Enter new ingredients (comma separated):', ingredients) || ingredients;
      const newPrepSteps = prompt('Enter new preparation steps (comma separated):', preparationSteps) || preparationSteps;
      const newCookingTime = prompt('Enter new cooking time:', cookingTime) || cookingTime;
      const newOrigin = prompt('Enter new origin:', origin) || origin;
      const newSpiceLevel = prompt('Enter new spice level (0 to 5):', spiceLevel) || spiceLevel;
      const data = {
        name: newName,
        ingredients: newIngredients.split(',').map(i => i.trim()),
        preparationSteps: newPrepSteps.split(',').map(step => step.trim()),
        cookingTime: Number(newCookingTime),
        origin: newOrigin,
        spiceLevel: Number(newSpiceLevel)
      };
      const response = await fetch(`${API_URL}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (response.ok) {
        loadDishes();
      } else {
        const errorData = await response.json();
        alert(errorData.error || 'Error updating dish');
      }
    }

    async function deleteDish(id) {
      if (!confirm('Are you sure you want to delete this dish?')) return;
      const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
      if (response.ok) {
        loadDishes();
      } else {
        const errorData = await response.json();
        alert(errorData.error || 'Error deleting dish');
      }
    }

    function resetAndFocusForm() {
      document.getElementById('add-dish-form').reset();
      document.getElementById('add-dish-form').scrollIntoView({ behavior: "smooth" });
    }

    loadDishes();
  </script>
</body>
</html>
